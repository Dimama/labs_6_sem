# Лабораторная №2 по моделированию
Необходимо решить систему ОДУ и вывести значения *I(t), Uc(t), Ucp(t), Rp(t).*
Система:

![A](https://latex.codecogs.com/svg.latex?L_k\frac{dI}{dt}&space;&plus;&space;(R_k&space;&plus;&space;R_p\(I\))I&space;-&space;U_c&space;=&space;0)

![B](https://latex.codecogs.com/svg.latex?\frac{dUc}{dt}&space;=&space;-\frac{I}{Ck})

Rp, оно же сопротивление газоразрядной трубки, находится в зависимости от силы тока, о нем чуть позже.

### Интерполяция табличных данных
***
Начнем с самой простой части. Для нахождения сопротивления постоянно потребуется брать данные из трех таблиц.

I|T0|m
-----|-------|----
0.5  |6400   |0.40
1    |6790   |0.55
5    |7150   |1.70
10   |7270   |3.0
50   |8010   |11.0
200  |9185   |32.0
400  |10010  |40.0
800  |11140  |41.0
1200 |12010  |39.0

Здесь все просто, используем обычную линейную интерполяцию:

![](https://latex.codecogs.com/svg.latex?T\(I\)&space;=&space;T\(I_0\)&space;&plus;&space;\frac{T(I_1)&space;-&space;T(I_0)}{I_1&space;-&space;I_0}&space;(I&space;-&space;I_0))
, где `(I0, T0)` и `(I1, T1)` - узлы таблицы, между которыми находится нужное значение
Аналогично находим `m(I)`
***
Также имеем еще две похожие таблицы - для электропроводности и концентрации частиц.
#### Концентрация тяжелых частиц n

T|p = 5атм|p = 15атм|p = 25атм
---|---|---|---
1000 | 3.62e+01 | 1.086e+02 | 1.81e+02
1500 | 2.41e+01 | 7.242e+01 | 1.21e+02
2000 | 1.81e+01 | 5.431e+01 | 9.05e+01
2500 | 1.45e+01 | 4.345e+01 | 7.24e+01
3000 | 1.21e+01 | 3.621e+01 | 6.04e+01
3500 | 1.03e+01 | 3.104e+01 | 5.17e+01
4000 | 9.05e+00 | 2.716e+01 | 4.53e+01
4500 | 8.05e+00 | 2.414e+01 | 4.02e+01
5000 | 7.24e+00 | 2.173e+01 | 3.62e+01
6000 | 6.03e+00 | 1.810e+01 | 3.02e+01
7000 | 5.16e+00 | 1.550e+01 | 2.58e+01
8000 | 4.49e+00 | 1.350e+01 | 2.25e+01
9000 | 3.92e+00 | 1.188e+01 | 1.99e+01
10000 | 3.39e+00 | 1.044e+01 | 1.76e+01
11000 | 2.87e+00 | 9.089e+00 | 1.54e+01
12000 | 2.37e+00 | 7.784e+00 | 1.34e+01
13000 | 1.94e+00 | 6.564e+00 | 1.14e+01
14000 | 1.62e+00 | 5.516e+00 | 9.72e+00
15000 | 1.40e+00 | 4.695e+00 | 8.30e+00

#### Коэффициент электропроводности σ

T|p = 5атм|p = 15атм|p = 25атм
---|---|---|---
2000 | 0.525e-3 | 0.309e-3 | 0.239e-3
3000 | 0.525e-2 | 0.309e-2 | 0.239e-2
4000 | 0.525e-1 | 0.309e-1 | 0.239e-1
5000 | 0.442e+0 | 0.270e+0 | 0.214e+0
6000 | 0.283e1 | 0.205e1 | 0.175e1
7000 | 0.741e1 | 0.606e1 | 0.545e1
8000 | 0.138e2 | 0.120e2 | 0.111e2
9000 | 0.220e2 | 0.199e2 | 0.188e2
10000 | 0.317e2 | 0.296e2 | 0.284e2
11000 | 0.428e2 | 0.411e2 | 0.399e2
12000 | 0.547e2 | 0.541e2 | 0.533e2
13000 | 0.664e2 | 0.677e2 | 0.677e2
14000 | 0.769e2 | 0.815e2 | 0.825e2
15000 | 0.861e2 | 0.938e2 | 0.965e2
16000 | 0.941e2 | 0.105eЗ | 0.109eЗ
17000 | 0.102eЗ | 0.115eЗ | 0.120eЗ
18000 | 0.112eЗ | 0.124eЗ | 0.131e3
19000 | 0.126eЗ | 0.135e3 | 0.142eЗ
20000 | 0.149eЗ | 0.150eЗ | 0.154eЗ

Здесь необходима интерполяция по двум переменным: линейная интерполяция по давлению и логарифмическая - по температуре.

![](https://upload.wikimedia.org/wikipedia/commons/thumb/e/e7/Bilinear_interpolation.png/220px-Bilinear_interpolation.png) 
Картинка с википедии "для ясности"
* Определяете "квадрат", в котором необходимо интерполировать
* Интерполируете по одной из осей (по аналогии с рисунком выше - находим значения R1 и R2
* Интерполируете по второй оси и получаете нужное значение

Я сначала интерполирую по температуре (хотя лучше было бы сначала по давлению, но кого это волнует?). 
От обычной линейной интерполяции эта отличается лишь тем, что интерполируем мы не значение функции f(x), а ее логарифм - log(f(x)). Затем нужно взять экспоненту и получится искомый результат.

![](https://latex.codecogs.com/svg.latex?n_{log0}=&space;log\(n\(T_0,&space;p_0\)\)&space;&plus;&space;\frac{log\(n\(T_1,&space;p_0\)\)&space;-&space;log\(n\(T_0,&space;p_0\)\)}{T_1&space;-&space;T_0}&space;(T&space;-&space;T_0))

![](https://latex.codecogs.com/svg.latex?n_{log1}=&space;log\(n\(T_0,&space;p_1\)\)&space;&plus;&space;\frac{log\(n\(T_1,&space;p_1\)\)&space;-&space;log\(n\(T_0,&space;p_1\)\)}{T_1&space;-&space;T_0}&space;(T&space;-&space;T_0))

Две формулы выше отличаются только значением давления (условно говоря, находим точку слева и точку справа).
И теперь интерполируем по второй оси:

![](http://latex.codecogs.com/gif.latex?n\(T,&space;p\)&space;=&space;exp(n_{log0})&space;&plus;&space;\frac{exp(n_{log1})&space;-&space;exp(n_{log0})}{p_1&space;-&space;p_0}&space;(p&space;-&space;p_0))

Все то же самое происходит для второй таблицы σ.

_Замечание. В идеале будет не считать логарифмы каждый раз, а завести вторую таблицу, в которой хранить заранее посчитанные логарифмы._

### Нахождение Rp(I)
***

Для нахождения _Rp_ необходимо воспользоваться данной формулой:
![](http://latex.codecogs.com/svg.latex?R_p&space;=&space;\frac{l_e}{2\pi\int_{0}^{R}\sigma\(T(r),&space;p\)rdr})

Однако в ней нам неизвестно давление _p_. Оно находится из следующего уравнения:
![](http://latex.codecogs.com/svg.latex?\frac{2}{R^2}\int_{0}^{R}n\(T\(r\),&space;p\)rdr&space;-&space;\frac{p_{0[atm]}\cdot&space;7242}{T_{start}}&space;=&space;0)

В этом уравнении все величины заданы, неизвестно лишь _p_. 
Это уравнение вида f(x) = 0 можно решить методом дихотомии. 
_Замечание. Я не буду детально описывать метод половинного деления, потому что... ну просто не буду, и все._
Сначала необходимо локализовать корень, т.е. найти границы отрезка, гарантированно содержащего корень. Я, чтобы точно не пропустить корень, начинаю искать отрезок с _p = 1_ с шагом _h = 1_. Нам нужно найти такой отрезок, чтобы у функции на его концах были разные знаки, т.е. `f(p) * f(p+h) < 0`. После этого сокращаем интервал половинным делением, пока не достигнем нужной точности.

*О точности решения уравнения*
Часто в цикле пишут условие вида _while |r - l| > ε_. Таким образом мы задаем _абсолютную_ точность, и это некошерно. Лучше задавать _относительную_ точность, т.е. условие будет выглядеть как _while |(r-l)/x| > ε_, где _x = (r + l) / 2_.
Градов мне делал внушение на эту тему на втором курсе, возможно, в этот раз тоже вспомнит.

*Вычисление интеграла*
Каждый раз при вычислении функции нам необходимо считать интеграл 
![](http://latex.codecogs.com/svg.latex?\int_{0}^{R}n\(T(r),&space;p\)rdr)

Для этого воспользуемся методом Симпсона
![](https://wikimedia.org/api/rest_v1/media/math/render/svg/66c8c4e7dbfcaf9b3045745b4fd7b9240f1cae71)

Вообще для данного метода нужно любое нечетное количество узлов, но повелением свыше интеграл считается с использованием **41** узла.
В начале вычисления сопротивления _Rp_ (а именно ради него все это происходит, если кто забыл) стоит завести массив температур _T( r )_ из 41 элемента. Температура высчитывается по формуле:
![](http://latex.codecogs.com/svg.latex?T(r)&space;=&space;(T_w&space;-&space;T_0)(r/R)^m&space;&plus;&space;T_0), где
_T0_ и _m_ считаются из таблицы (ага! именно здесь проявляется зависимость Rp от силы тока I), а Tw и R - константы.
Теперь можно считать интеграл по данной формуле Симпсона. _n(T, p)_ получается опять-таки из табличных значений.
***
После решения уравнения полученное значение давления _p_ можно подставить в формулу для Rp:
![](http://latex.codecogs.com/svg.latex?R_p&space;=&space;\frac{l_e}{2\pi\int_{0}^{R}\sigma\(T(r),&space;p\)rdr})
Интеграл в ней считается аналогичным образом, массив температур можно использовать тот же самый, а σ(T, p) берется опять-таки из таблицы.

#### Краткое повторение вышеописанного
***
1. Составить массив температур для интегрирования
2. Решить уравнение с интегралом для получения p
3. Подставить p в итоговую формулу и получить Rp







